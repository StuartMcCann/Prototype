
@model IEnumerable<Prototype.Models.ApplicationUser>

<script type="text/javascript">




    $(document).on("click", '.loadconversation', function (event) {
        alert("new link clicked!");

         $.ajax({
            url: '/Chat/GetConversation',
            dataType: "Json",
            type: "GET",
            contentType: 'application/json; charset=utf-8',
             cache: false,
             
            //this needs changed whe table fully normalised

            success: function (data) {
                console.log(data); 
               // loops through values returned in json format by above url
                $.each(data, function (key, val) {
                  

                 
                   
                });//end of for loop

            }, //end of success function
            error: function (xhr) {
                alert( 'error');
            }

        }); //end ajax

    });//end on click

    function NameClicked(elem) {
        var id = $(elem).data('assigned-id');
        console.log(id)
       

       
        $.ajax({
            url: '/Chat/GetConversation',
            dataType: "Json",
            type: "GET",
            contentType: 'application/json; charset=utf-8',
            cache: false,
            data: { contactId: id },
            //this needs changed whe table fully normalised

            success: function (data) {
                console.log(data);
                // loops through values returned in json format by above url
                
                $.each(data, function (key, val) {
                    $("#conversation").replaceWith(
                        '<div class="card">' +
                        '<div class="card-body">' +
                        '<p>' + val.message + '</p>' +
                        '<p>' + val.fromUserId + '</p>' +
                        '</div>' +
                        '</div>'
                    );
                });//end of for loop
                

               

            }, //end of success function
            error: function (xhr) {
                alert('error');
            }

        }); //end ajax
        





    }//end of name clicked 



</script>



                    <div class="container text buffer  fullHeight">


                        <h2>Your Messages</h2>

                        <div class="row buffer messages">
                            <div class="col-sm-9 border">
                                <div class="row border messages scrollgrid">
                                  

                                    <div id="conversation"></div>


                                </div>

                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="input-group input-group-lg">
                                            <input type="text" class="form-control input-lg" id="search-church" placeholder="Type your message here...">
                                            <span class="input-group-btn">
                                                <button class="btn btn-primary" type="submit">Send</button>
                                            </span>
                                        </div>
                                    </div>
                                </div>







                            </div>

                            <div class="col-sm-3  scrollgrid  border">

                                <div ">

                                    @if (Model.Count() > 0)
                                    {
                                        @foreach (var user in Model)
                                        {
                                    <div class="card">
                                        <div class="card-body">
                                            <p onclick="NameClicked(this)"
                                                       data-assigned-id="@user.Id">
                                              @user.FirstName @user.LastName

                                            </p> 
                                        </div>
                                    </div>
                                        }
                                    }


                                </div>


                            </div>


                        </div>




















                    </div>